var express = require('express');
var app = express();
// var path = require("path");
var html = require("html");
var request = require("request");
var cheerio = require('cheerio');

// var prevData = require("./data.js");

app.use(express.static(__dirname + '/domainParserviews'));
app.use(express.static(__dirname + '/views'));
app.engine('.html', require('ejs').renderFile);

app.get('/');

var fs = require('fs')

var allTrialCodes = ["NCT00000173","NCT00000177","NCT00000403","NCT00000412","NCT00000425","NCT00000427","NCT00000476","NCT00000478","NCT00000479","NCT00000480","NCT00000529","NCT00000530","NCT00000539","NCT00000542","NCT00000549","NCT00000553","NCT00000555","NCT00000556","NCT00000558","NCT00000559","NCT00000560","NCT00000569","NCT00000601","NCT00000605","NCT00000609","NCT00000610","NCT00000614","NCT00000617","NCT00001629","NCT00002246","NCT00004297","NCT00004497","NCT00004563","NCT00004650","NCT00004662","NCT00004733","NCT00004734","NCT00004754","NCT00004786","NCT00004795","NCT00004817","NCT00004941","NCT00005007","NCT00006305","NCT00006398","NCT00007670","NCT00007683","NCT00009204","NCT00026039","NCT00027066","NCT00029822","NCT00029848","NCT00030979","NCT00032786","NCT00032799","NCT00032890","NCT00034762","NCT00034840","NCT00035191","NCT00035256","NCT00035451","NCT00035568","NCT00035984","NCT00036114","NCT00036153","NCT00036439","NCT00038077","NCT00038961","NCT00039013","NCT00039026","NCT00040326","NCT00041678","NCT00041938","NCT00042068","NCT00042718","NCT00043069","NCT00043784","NCT00043849","NCT00043901","NCT00044447","NCT00044460","NCT00044746","NCT00044811","NCT00044824","NCT00045955","NCT00046150","NCT00046228","NCT00046254","NCT00046462","NCT00046748","NCT00046761","NCT00047424","NCT00047580","NCT00048113","NCT00048425","NCT00048568","NCT00048581","NCT00048932","NCT00049829","NCT00051142","NCT00051285","NCT00051558","NCT00051623","NCT00052039","NCT00053599","NCT00054418","NCT00055497","NCT00056225","NCT00058929","NCT00059306","NCT00060918","NCT00060931","NCT00060996","NCT00061503","NCT00062556","NCT00062582","NCT00062790","NCT00063687","NCT00064389","NCT00064415","NCT00064428","NCT00064467","NCT00064649","NCT00065637","NCT00065767","NCT00067041","NCT00067093","NCT00069784","NCT00069823","NCT00070590","NCT00070707","NCT00071266","NCT00071331","NCT00071461","NCT00071552","NCT00071721","NCT00073177","NCT00073372","NCT00073827","NCT00074542","NCT00075998","NCT00076076","NCT00076089","NCT00077584","NCT00077753","NCT00077779","NCT00077792","NCT00077805","NCT00077818","NCT00077948","NCT00078338","NCT00078611","NCT00079638","NCT00079924","NCT00080275","NCT00081653","NCT00081731","NCT00082381","NCT00082407","NCT00082511","NCT00085644","NCT00086502","NCT00086515","NCT00087516","NCT00087529","NCT00089791","NCT00089804","NCT00089895","NCT00090103","NCT00090116","NCT00090168","NCT00090298","NCT00091429","NCT00091598","NCT00091715","NCT00091793","NCT00091949","NCT00092014","NCT00092027","NCT00092040","NCT00092053","NCT00092066","NCT00092079","NCT00092118","NCT00092144","NCT00092157","NCT00092209","NCT00092352","NCT00092365","NCT00092560","NCT00092573","NCT00092586","NCT00092599","NCT00092612","NCT00092625","NCT00092638","NCT00092651","NCT00092664","NCT00092690","NCT00092703","NCT00092716","NCT00092742","NCT00092755","NCT00092768","NCT00092781","NCT00092885","NCT00092963","NCT00092989","NCT00093158","NCT00093249","NCT00093262","NCT00093886","NCT00093899","NCT00093912","NCT00093925","NCT00094302","NCT00094458","NCT00094757","NCT00094770","NCT00095004","NCT00095056","NCT00095082","NCT00095238","NCT00095394","NCT00095550","NCT00096473","NCT00096603","NCT00096655","NCT00096954","NCT00096980","NCT00097084","NCT00097279","NCT00097500","NCT00097591","NCT00097786","NCT00097812","NCT00097825","NCT00097916","NCT00099216","NCT00099242","NCT00099268","NCT00099320","NCT00099788","NCT00099853","NCT00099866","NCT00099892","NCT00099905","NCT00099918","NCT00099931","NCT00099944","NCT00100555","NCT00100620","NCT00101673","NCT00101712","NCT00101751","NCT00101803","NCT00102388","NCT00102440","NCT00102466","NCT00102765","NCT00102882","NCT00103649","NCT00103922","NCT00104013","NCT00104182","NCT00104416","NCT00104442","NCT00105300","NCT00106132","NCT00106340","NCT00106366","NCT00106522","NCT00106535","NCT00106561","NCT00106574","NCT00106821","NCT00106847","NCT00108251","NCT00108823","NCT00109187","NCT00109200","NCT00109252","NCT00109317","NCT00109382","NCT00109408","NCT00109668","NCT00110240","NCT00110422","NCT00110435","NCT00110474","NCT00111306","NCT00111449","NCT00111709","NCT00111722","NCT00112281","NCT00113165","NCT00115492","NCT00115622","NCT00115726","NCT00115830","NCT00116428","NCT00116545","NCT00116831","NCT00117325","NCT00117780","NCT00118703","NCT00118729","NCT00118937","NCT00118963","NCT00120003","NCT00120289","NCT00120328","NCT00120380","NCT00120588","NCT00120757","NCT00120900","NCT00121446","NCT00121667","NCT00121966","NCT00123604","NCT00123643","NCT00123903","NCT00124332","NCT00124397","NCT00125918","NCT00126022","NCT00126061","NCT00126074","NCT00126516","NCT00127179","NCT00127218","NCT00127647","NCT00129038","NCT00129142","NCT00129233","NCT00129545","NCT00129805","NCT00130039","NCT00130468","NCT00130975","NCT00131274","NCT00131664","NCT00131846","NCT00132418","NCT00132717","NCT00132938","NCT00133003","NCT00133185","NCT00133198","NCT00133250","NCT00133692","NCT00134147","NCT00134160","NCT00134979","NCT00135057","NCT00135096","NCT00135226","NCT00135876","NCT00135993","NCT00136019","NCT00136045","NCT00136058","NCT00136773","NCT00136799","NCT00136851","NCT00137397","NCT00137410","NCT00138515","NCT00138541","NCT00138567","NCT00138580","NCT00138619","NCT00138723","NCT00138866","NCT00138983","NCT00139555","NCT00139815","NCT00140946","NCT00140972","NCT00141102","NCT00141141","NCT00141232","NCT00141453","NCT00141778","NCT00141960","NCT00142025","NCT00142584","NCT00143195","NCT00143221","NCT00143377","NCT00143481","NCT00143507","NCT00143520","NCT00144196","NCT00144326","NCT00144339","NCT00144508","NCT00144521","NCT00145210","NCT00145236","NCT00145301","NCT00145327","NCT00145730","NCT00145925","NCT00146068","NCT00146341","NCT00146640","NCT00147654","NCT00147719","NCT00147758","NCT00148408","NCT00148460","NCT00149227","NCT00150410","NCT00150696","NCT00150774","NCT00150787","NCT00150826","NCT00151294","NCT00151502","NCT00151749","NCT00151827","NCT00151944","NCT00152373","NCT00152386","NCT00152425","NCT00152490","NCT00152958","NCT00152971","NCT00152984","NCT00153023","NCT00153036","NCT00153062","NCT00153088","NCT00153244","NCT00153270","NCT00153283","NCT00153296","NCT00153660","NCT00153673","NCT00154219","NCT00157235","NCT00157586","NCT00157651","NCT00157690","NCT00157872","NCT00157911","NCT00158847","NCT00159861","NCT00160550","NCT00160589","NCT00160602","NCT00161070","NCT00162084","NCT00162864","NCT00163150","NCT00163202","NCT00163241","NCT00163319","NCT00163345","NCT00163358","NCT00163384","NCT00163397","NCT00163423","NCT00163436","NCT00163475","NCT00163527","NCT00164840","NCT00165646","NCT00165737","NCT00165815","NCT00166530","NCT00168779","NCT00168792","NCT00168805","NCT00168818","NCT00168831","NCT00168844","NCT00168857","NCT00169819","NCT00170183","NCT00170222","NCT00170378","NCT00170924","NCT00170950","NCT00170963","NCT00170989","NCT00171002","NCT00171015","NCT00171054","NCT00171067","NCT00171093","NCT00171106","NCT00171119","NCT00171132","NCT00171145","NCT00171184","NCT00171275","NCT00171327","NCT00171366","NCT00171418","NCT00171483","NCT00171496","NCT00171535","NCT00171561","NCT00171574","NCT00171756","NCT00172081","NCT00174239","NCT00174317","NCT00174330","NCT00174642","NCT00174668","NCT00174681","NCT00174720","NCT00174733","NCT00174759","NCT00174785","NCT00174824","NCT00174915","NCT00174993","NCT00175019","NCT00175032","NCT00175565","NCT00175903","NCT00177138","NCT00180037","NCT00181181","NCT00181818","NCT00182143","NCT00182364","NCT00182403","NCT00184522","NCT00184561","NCT00184600","NCT00184626","NCT00184665","NCT00184977","NCT00185094","NCT00185133","NCT00185159","NCT00185172","NCT00185185","NCT00186901","NCT00187408","NCT00187889","NCT00188825","NCT00190580","NCT00190619","NCT00190814","NCT00190827","NCT00190996","NCT00191009","NCT00191282","NCT00191425","NCT00191464","NCT00195494","NCT00195507","NCT00195663","NCT00195819","NCT00196690","NCT00197080","NCT00199251","NCT00199927","NCT00200356","NCT00200434","NCT00200460","NCT00200473","NCT00200525","NCT00202020","NCT00202124","NCT00202566","NCT00202878","NCT00203034","NCT00203060","NCT00203125","NCT00203580","NCT00203632","NCT00203658","NCT00204022","NCT00206154","NCT00206167","NCT00206180","NCT00206310","NCT00207428","NCT00207662","NCT00207701","NCT00207766","NCT00208299","NCT00208312","NCT00208819","NCT00209430","NCT00209859","NCT00210496","NCT00210509","NCT00210782","NCT00210821","NCT00210912","NCT00211705","NCT00212667","NCT00212719","NCT00212732","NCT00212810","NCT00212823","NCT00213135","NCT00214552","NCT00215436","NCT00216411","NCT00216502","NCT00216593","NCT00216606","NCT00216892","NCT00219024","NCT00219037","NCT00219063","NCT00219076","NCT00219089","NCT00219102","NCT00219115","NCT00219128","NCT00219141","NCT00219154","NCT00219167","NCT00219180","NCT00219193","NCT00219388","NCT00219973","NCT00220220","NCT00220233","NCT00220363","NCT00220415","NCT00220831","NCT00220961","NCT00221156","NCT00222261","NCT00222573","NCT00224107","NCT00224120","NCT00224146","NCT00225108","NCT00225264","NCT00225277","NCT00225589","NCT00227318","NCT00227344","NCT00228514","NCT00229424","NCT00230698","NCT00231387","NCT00231530","NCT00231556","NCT00231595","NCT00231621","NCT00231634","NCT00231660","NCT00231738","NCT00231946","NCT00232050","NCT00232596","NCT00232674","NCT00232882","NCT00233441","NCT00234065","NCT00234845","NCT00234858","NCT00234871","NCT00234897","NCT00235014","NCT00235248","NCT00235716","NCT00235755","NCT00235859","NCT00235911","NCT00235950","NCT00236028","NCT00236366","NCT00236392","NCT00236418","NCT00236431","NCT00236509","NCT00236561","NCT00236574","NCT00236665","NCT00236704","NCT00236717","NCT00237237","NCT00237614","NCT00237653","NCT00237887","NCT00238472","NCT00238784","NCT00239330","NCT00239369","NCT00239408","NCT00239421","NCT00239434","NCT00239460","NCT00239473","NCT00239499","NCT00239538","NCT00240279","NCT00240292","NCT00240409","NCT00240422","NCT00240435","NCT00240448","NCT00240474","NCT00240786","NCT00241488","NCT00241605","NCT00242294","NCT00242307","NCT00242411","NCT00242606","NCT00242775","NCT00242944","NCT00243178","NCT00243724","NCT00243971","NCT00244387","NCT00244426","NCT00244530","NCT00244556","NCT00244842","NCT00245908","NCT00246909","NCT00246922","NCT00247247","NCT00247962","NCT00249145","NCT00249158","NCT00249249","NCT00249795","NCT00249873","NCT00250445","NCT00250679","NCT00251134","NCT00251576","NCT00251641","NCT00251693","NCT00251706","NCT00251719","NCT00251745","NCT00251758","NCT00251823","NCT00251901","NCT00251927","NCT00251966","NCT00252668","NCT00252785","NCT00252824","NCT00252863","NCT00253175","NCT00253188","NCT00253214","NCT00253227","NCT00253851","NCT00254956","NCT00255151","NCT00255164","NCT00255190","NCT00256139","NCT00256204","NCT00256867","NCT00259051","NCT00259077","NCT00259376","NCT00259428","NCT00259610","NCT00259766","NCT00259792","NCT00260923","NCT00260988","NCT00261573","NCT00262054","NCT00262236","NCT00262600","NCT00263393","NCT00264212","NCT00264277","NCT00264537","NCT00264550","NCT00264849","NCT00264901","NCT00265083","NCT00265096","NCT00266227","NCT00266591","NCT00267176","NCT00267215","NCT00267969","NCT00268177","NCT00268216","NCT00268619","NCT00268632","NCT00268697","NCT00269191","NCT00269841","NCT00269854","NCT00269867","NCT00269893","NCT00269906","NCT00269932","NCT00270361","NCT00271557","NCT00272012","NCT00272090","NCT00272103","NCT00272454","NCT00272701","NCT00272805","NCT00273026","NCT00273052","NCT00273299","NCT00274014","NCT00274040","NCT00274053","NCT00274079","NCT00274092","NCT00274105","NCT00274118","NCT00274144","NCT00274274","NCT00274508","NCT00274521","NCT00274547","NCT00274560","NCT00274573","NCT00274586","NCT00274599","NCT00274612","NCT00276484","NCT00277264","NCT00277394","NCT00277472","NCT00277602","NCT00279045","NCT00280046","NCT00280059","NCT00280371","NCT00280540","NCT00281593","NCT00282360","NCT00282932","NCT00283335","NCT00283751","NCT00284232","NCT00285519","NCT00286429","NCT00286442","NCT00286455","NCT00286468","NCT00286494","NCT00286897","NCT00287209","NCT00287716","NCT00287729","NCT00287742","NCT00288236","NCT00288483","NCT00288587","NCT00288951","NCT00289042","NCT00289198","NCT00289848","NCT00290030","NCT00290264","NCT00290927","NCT00290979","NCT00291330","NCT00294710","NCT00294723","NCT00295022","NCT00295633","NCT00296218","NCT00296387","NCT00296491","NCT00296530","NCT00297063","NCT00297102","NCT00297115","NCT00297375","NCT00299013","NCT00299104","NCT00299533","NCT00299546","NCT00300118","NCT00300196","NCT00300430","NCT00301574","NCT00303277","NCT00303459","NCT00305162","NCT00306696","NCT00307060","NCT00307307","NCT00307437","NCT00307645","NCT00308347","NCT00309244","NCT00309738","NCT00309751","NCT00309777","NCT00309790","NCT00311363","NCT00311402","NCT00311740","NCT00311753","NCT00311818","NCT00311896","NCT00312013","NCT00312104","NCT00313001","NCT00313209","NCT00313313","NCT00313937","NCT00314158","NCT00314574","NCT00314652","NCT00314860","NCT00315523","NCT00315848","NCT00316095","NCT00317486","NCT00318422","NCT00319995","NCT00320229","NCT00321737","NCT00321854","NCT00321984","NCT00322153","NCT00322257","NCT00324363","NCT00325390","NCT00325403","NCT00325442","NCT00325676","NCT00325806","NCT00325858","NCT00326053","NCT00327015","NCT00327145","NCT00327418","NCT00327691","NCT00328523","NCT00328692","NCT00328939","NCT00329173","NCT00329225","NCT00329238","NCT00329355","NCT00329459","NCT00329602","NCT00329628","NCT00330460","NCT00330850","NCT00331487","NCT00331604","NCT00331825","NCT00331851","NCT00332020","NCT00333112","NCT00333151","NCT00333489","NCT00333723","NCT00334958","NCT00335101","NCT00335166","NCT00335699","NCT00336336","NCT00337558","NCT00338117","NCT00338143","NCT00338260","NCT00340678","NCT00343252","NCT00343499","NCT00343551","NCT00343980","NCT00344110","NCT00346216","NCT00347087","NCT00347100","NCT00347360","NCT00348010","NCT00348140","NCT00348309","NCT00348452","NCT00348504","NCT00348712","NCT00349531","NCT00350168","NCT00351585","NCT00351884","NCT00353080","NCT00353912","NCT00354458","NCT00354939","NCT00355667","NCT00355849","NCT00356096","NCT00358124","NCT00358176","NCT00358436","NCT00359112","NCT00359762","NCT00359788","NCT00359905","NCT00360308","NCT00360984","NCT00361335","NCT00361894","NCT00361959","NCT00362232","NCT00362323","NCT00362960","NCT00363727","NCT00363857","NCT00363896","NCT00365170","NCT00365313","NCT00365352","NCT00365950","NCT00366301","NCT00366938","NCT00367055","NCT00367211","NCT00367315","NCT00367978","NCT00368108","NCT00368134","NCT00368277","NCT00368979","NCT00370565","NCT00371683","NCT00372372","NCT00373451","NCT00373685","NCT00374426","NCT00375284","NCT00375388","NCT00376272","NCT00377624","NCT00377637","NCT00377676","NCT00377819","NCT00377858","NCT00379067","NCT00379249","NCT00379288","NCT00379769","NCT00380939","NCT00381472","NCT00381485","NCT00382096","NCT00382213","NCT00382889","NCT00383136","NCT00383240","NCT00383552","NCT00383578","NCT00383929","NCT00384072","NCT00384085","NCT00384215","NCT00384930","NCT00385138","NCT00385593","NCT00385736","NCT00385931","NCT00386100","NCT00386139","NCT00387088","NCT00387517","NCT00387881","NCT00388882","NCT00389740","NCT00389779","NCT00390728","NCT00391443","NCT00391872","NCT00392002","NCT00392093","NCT00393458","NCT00393471","NCT00393705","NCT00393718","NCT00393991","NCT00394199","NCT00394368","NCT00395343","NCT00395512","NCT00395603","NCT00396227","NCT00396357","NCT00397631","NCT00397657","NCT00398606","NCT00398931","NCT00399464","NCT00399711","NCT00399724","NCT00400153","NCT00400777","NCT00401596","NCT00402233","NCT00402363","NCT00402441","NCT00402506","NCT00403767","NCT00403910","NCT00404053","NCT00404547","NCT00404716","NCT00404820","NCT00405171","NCT00405236","NCT00405418","NCT00405717","NCT00406419","NCT00407446","NCT00408174","NCT00408187","NCT00408512","NCT00408629","NCT00409643","NCT00409760","NCT00409851","NCT00410384","NCT00410410","NCT00411554","NCT00412256","NCT00412984","NCT00413049","NCT00413387","NCT00413413","NCT00413972","NCT00414609","NCT00414973","NCT00418548","NCT00418834","NCT00419744","NCT00419757","NCT00419952","NCT00421122","NCT00421915","NCT00422227","NCT00423085","NCT00423319","NCT00423748","NCT00423995","NCT00424268","NCT00424333","NCT00424437","NCT00424476","NCT00425997","NCT00426751","NCT00428090","NCT00429377","NCT00430105","NCT00430248","NCT00430677","NCT00430729","NCT00430807","NCT00432081","NCT00432276","NCT00432796","NCT00433732","NCT00433784","NCT00433966","NCT00434083","NCT00434954","NCT00434967","NCT00435448","NCT00435461","NCT00437697","NCT00438451","NCT00439244","NCT00439283","NCT00439647","NCT00439725","NCT00439738","NCT00439777","NCT00439855","NCT00440050","NCT00440193","NCT00440687","NCT00441246","NCT00441350","NCT00442546","NCT00443690","NCT00444925","NCT00445276","NCT00445770","NCT00447018","NCT00447759","NCT00447915","NCT00448461","NCT00449605","NCT00449722","NCT00449787","NCT00449930","NCT00450164","NCT00451360","NCT00451412","NCT00452348","NCT00452530","NCT00452699","NCT00453063","NCT00454584","NCT00454662","NCT00454896","NCT00457002","NCT00462748","NCT00463606","NCT00463866","NCT00464269","NCT00464308","NCT00466167","NCT00467376","NCT00468546","NCT00469092","NCT00470522","NCT00471341","NCT00471549","NCT00472199","NCT00473655","NCT00474045","NCT00475514","NCT00475852","NCT00476034","NCT00476268","NCT00476996","NCT00477295","NCT00479362","NCT00479401","NCT00479713","NCT00480766","NCT00480805","NCT00480870","NCT00481169","NCT00481364","NCT00482729","NCT00484198","NCT00484926","NCT00485589","NCT00486343","NCT00487240","NCT00487539","NCT00488267","NCT00488631","NCT00489424","NCT00489736","NCT00490035","NCT00490958","NCT00491907","NCT00493480","NCT00494013","NCT00494312","NCT00494871","NCT00496470","NCT00496769","NCT00497237","NCT00499707","NCT00500604","NCT00500955","NCT00501020","NCT00502775","NCT00503113","NCT00503152","NCT00503243","NCT00504127","NCT00504881","NCT00509262","NCT00510952","NCT00513630","NCT00518882","NCT00519142","NCT00521131","NCT00521599","NCT00521742","NCT00521820","NCT00523991","NCT00524836","NCT00525278","NCT00525382","NCT00525512","NCT00525824","NCT00526474","NCT00527943","NCT00528879","NCT00529178","NCT00529451","NCT00529529","NCT00529750","NCT00530556","NCT00531817","NCT00532935","NCT00536484","NCT00536731","NCT00537238","NCT00537940","NCT00538148","NCT00538902","NCT00540527","NCT00540709","NCT00540787","NCT00540891","NCT00541450","NCT00541489","NCT00541697","NCT00542087","NCT00542555","NCT00542633","NCT00542724","NCT00542789","NCT00542984","NCT00543023","NCT00543218","NCT00544154","NCT00544388","NCT00545324","NCT00546507","NCT00546637","NCT00546754","NCT00546832","NCT00547300","NCT00548509","NCT00548574","NCT00548808","NCT00548834","NCT00549146","NCT00549549","NCT00549757","NCT00550953","NCT00551356","NCT00551447","NCT00551876","NCT00552058","NCT00552097","NCT00552370","NCT00553267","NCT00553449","NCT00554710","NCT00555217","NCT00557921","NCT00558064","NCT00558259","NCT00558428","NCT00560417","NCT00561964","NCT00562289","NCT00562588","NCT00562952","NCT00563381","NCT00564668","NCT00565162","NCT00565409","NCT00565500","NCT00567996","NCT00568074","NCT00568295","NCT00568984","NCT00569400","NCT00570622","NCT00570739","NCT00570986","NCT00571506","NCT00571649","NCT00573443","NCT00573508","NCT00575588","NCT00579878","NCT00580840","NCT00589927","NCT00590174","NCT00590629","NCT00591253","NCT00591266","NCT00591578","NCT00591773","NCT00592969","NCT00593255","NCT00595374","NCT00596752","NCT00598793","NCT00600626","NCT00602472","NCT00604253","NCT00604344","NCT00604396","NCT00604656","NCT00605020","NCT00605111","NCT00608881","NCT00609674","NCT00609856","NCT00611026","NCT00614120","NCT00614380","NCT00614939","NCT00616772","NCT00617565","NCT00619697","NCT00619957","NCT00620542","NCT00620867","NCT00621140","NCT00622284","NCT00623623","NCT00624052","NCT00624065","NCT00624286","NCT00624338","NCT00624364","NCT00625547","NCT00626197","NCT00626535","NCT00627003","NCT00627016","NCT00627640","NCT00628342","NCT00628576","NCT00628667","NCT00628758","NCT00628862","NCT00630851","NCT00630929","NCT00631189","NCT00631917","NCT00633893","NCT00633932","NCT00634114","NCT00634309","NCT00634400","NCT00634712","NCT00635505","NCT00637273","NCT00637468","NCT00637611","NCT00637845","NCT00637949","NCT00638807","NCT00639158","NCT00640549","NCT00640627","NCT00641043","NCT00641056","NCT00641602","NCT00641680","NCT00641914","NCT00642096","NCT00642187","NCT00643045","NCT00643136","NCT00643201","NCT00643799","NCT00643851","NCT00644605","NCT00644735","NCT00645190","NCT00645268","NCT00646178","NCT00646542","NCT00646594","NCT00647270","NCT00647491","NCT00647920","NCT00648141","NCT00648258","NCT00649025","NCT00649389","NCT00650455","NCT00650663","NCT00650689","NCT00650819","NCT00651014","NCT00651118","NCT00651274","NCT00651287","NCT00651378","NCT00651391","NCT00651404","NCT00651651","NCT00652002","NCT00652106","NCT00652392","NCT00652444","NCT00652808","NCT00653341","NCT00653445","NCT00653588","NCT00653744","NCT00653796","NCT00653835","NCT00653965","NCT00654173","NCT00654225","NCT00654381","NCT00654407","NCT00654498","NCT00654537","NCT00655122","NCT00657150","NCT00657527","NCT00658528","NCT00658632","NCT00658775","NCT00659048","NCT00659503","NCT00659594","NCT00659750","NCT00659841","NCT00660179","NCT00660517","NCT00660907","NCT00660998","NCT00661362","NCT00662714","NCT00662909","NCT00663260","NCT00663897","NCT00664534","NCT00664560","NCT00665431","NCT00665600","NCT00666458","NCT00666718","NCT00667407","NCT00667797","NCT00668005","NCT00668109","NCT00670501","NCT00673231","NCT00673556","NCT00673790","NCT00673920","NCT00675740","NCT00676338","NCT00677807","NCT00678704","NCT00679380","NCT00679432","NCT00679484","NCT00679588","NCT00679627","NCT00679653","NCT00679731","NCT00680186","NCT00680745","NCT00680953","NCT00682643","NCT00683111","NCT00683618","NCT00683878","NCT00685425","NCT00685776","NCT00686712","NCT00687076","NCT00687453","NCT00687973","NCT00688688","NCT00688701","NCT00689104","NCT00689520","NCT00691964","NCT00692913","NCT00694382","NCT00696241","NCT00696384","NCT00696436","NCT00696631","NCT00697086","NCT00697099","NCT00697151","NCT00698646","NCT00698932","NCT00699192","NCT00699582","NCT00699972","NCT00699998","NCT00700310","NCT00700856","NCT00701090","NCT00702325","NCT00705575","NCT00706134","NCT00707031","NCT00707993","NCT00710580","NCT00712673","NCT00713830","NCT00714597","NCT00714961","NCT00715273","NCT00715624","NCT00716547","NCT00717236","NCT00717457","NCT00718224","NCT00720382","NCT00721760","NCT00722852","NCT00725036","NCT00727857","NCT00728351","NCT00729430","NCT00731289","NCT00731692","NCT00732524","NCT00732927","NCT00733902","NCT00734318","NCT00734474","NCT00734630","NCT00736879","NCT00739596","NCT00740285","NCT00740623","NCT00740714","NCT00740792","NCT00740883","NCT00744471","NCT00744926","NCT00747110","NCT00750113","NCT00751049","NCT00751062","NCT00751114","NCT00751127","NCT00751751","NCT00751829","NCT00753779","NCT00754039","NCT00754403","NCT00754429","NCT00754507","NCT00754988","NCT00755287","NCT00755352","NCT00757588","NCT00760214","NCT00760266","NCT00763451","NCT00763529","NCT00763815","NCT00764725","NCT00765674","NCT00765830","NCT00766545","NCT00768261","NCT00768300","NCT00770653","NCT00771394","NCT00772174","NCT00772499","NCT00772538","NCT00772577","NCT00772603","NCT00776984","NCT00778921","NCT00781391","NCT00782210","NCT00782509","NCT00783224","NCT00783237","NCT00783263","NCT00783692","NCT00783718","NCT00783744","NCT00784550","NCT00786474","NCT00787605","NCT00789737","NCT00789750","NCT00790023","NCT00790101","NCT00790205","NCT00790907","NCT00791999","NCT00792636","NCT00792727","NCT00792805","NCT00792818","NCT00793624","NCT00794157","NCT00796250","NCT00796653","NCT00796692","NCT00797316","NCT00798434","NCT00799448","NCT00801944","NCT00802373","NCT00806403","NCT00808067","NCT00809926","NCT00809965","NCT00810199","NCT00810693","NCT00812955","NCT00813995","NCT00814268","NCT00814801","NCT00818883","NCT00819325","NCT00819741","NCT00821093","NCT00821834","NCT00821977","NCT00822211","NCT00822536","NCT00823836","NCT00823992","NCT00827242","NCT00827411","NCT00829660","NCT00830063","NCT00831441","NCT00838214","NCT00838903","NCT00838916","NCT00839527","NCT00839800","NCT00841672","NCT00843154","NCT00843492","NCT00845728","NCT00846365","NCT00846586","NCT00848081","NCT00848354","NCT00849017","NCT00849056","NCT00849095","NCT00853658","NCT00853827","NCT00853957","NCT00855582","NCT00856206","NCT00856271","NCT00856284","NCT00856622","NCT00857285","NCT00857649","NCT00859183","NCT00859898","NCT00860262","NCT00860288","NCT00861757","NCT00861926","NCT00862251","NCT00862394","NCT00862420","NCT00862641","NCT00863304","NCT00863707","NCT00864097","NCT00864812","NCT00865020","NCT00866658","NCT00872001","NCT00872586","NCT00877383","NCT00877929","NCT00880620","NCT00883168","NCT00885352","NCT00886600","NCT00887250","NCT00887978","NCT00888355","NCT00891462","NCT00894387","NCT00894868","NCT00900731","NCT00901368","NCT00902304","NCT00909480","NCT00909597","NCT00909779","NCT00910689","NCT00911534","NCT00911547","NCT00911937","NCT00912964","NCT00913120","NCT00917254","NCT00919711","NCT00920543","NCT00922480","NCT00925600","NCT00926289","NCT00927394","NCT00928070","NCT00929110","NCT00929851","NCT00929864","NCT00931710","NCT00935532","NCT00936897","NCT00942994","NCT00946946","NCT00947843","NCT00949442","NCT00949884","NCT00950794","NCT00953147","NCT00953212","NCT00954447","NCT00956644","NCT00957060","NCT00957372","NCT00957554","NCT00960141","NCT00960661","NCT00963469","NCT00963599","NCT00965549","NCT00966004","NCT00968708","NCT00968812","NCT00970489","NCT00970632","NCT00971165","NCT00972283","NCT00972738","NCT00973479","NCT00974571","NCT00975195","NCT00975286","NCT00976391","NCT00977938","NCT00978627","NCT00979589","NCT00979628","NCT00979901","NCT00982228","NCT00982358","NCT00982644","NCT00984659","NCT00984867","NCT00985621","NCT00986050","NCT00986154","NCT00988429","NCT00993109","NCT00996281","NCT01001208","NCT01001494","NCT01001572","NCT01005901","NCT01006291","NCT01006603","NCT01007435","NCT01009086","NCT01009463","NCT01009580","NCT01010100","NCT01010971","NCT01013532","NCT01017952","NCT01018173","NCT01018186","NCT01018511","NCT01021696","NCT01021735","NCT01022762","NCT01028391","NCT01028586","NCT01029886","NCT01030081","NCT01031680","NCT01032629","NCT01033071","NCT01034137","NCT01035255","NCT01038427","NCT01039688","NCT01042392","NCT01042977","NCT01043666","NCT01045161","NCT01045447","NCT01045707","NCT01046110","NCT01047501","NCT01049984","NCT01051011","NCT01057251","NCT01059773","NCT01059799","NCT01059812","NCT01061671","NCT01063920","NCT01064687","NCT01066676","NCT01068600","NCT01068652","NCT01068665","NCT01068678","NCT01069003","NCT01069289","NCT01070784","NCT01071122","NCT01072448","NCT01074268","NCT01075282","NCT01075698","NCT01076075","NCT01076647","NCT01077362","NCT01079234","NCT01081834","NCT01086384","NCT01087723","NCT01087762","NCT01087788","NCT01089751","NCT01093534","NCT01094457","NCT01095653","NCT01095666","NCT01098539","NCT01099137","NCT01101009","NCT01106014","NCT01106534","NCT01106625","NCT01106651","NCT01106677","NCT01106690","NCT01107886","NCT01110200","NCT01117350","NCT01118312","NCT01119859","NCT01120691","NCT01120717","NCT01121224","NCT01121835","NCT01123980","NCT01126437","NCT01126580","NCT01128894","NCT01130025","NCT01130246","NCT01131182","NCT01131676","NCT01132638","NCT01134042","NCT01137474","NCT01137812","NCT01139762","NCT01142726","NCT01144338","NCT01147250","NCT01147848","NCT01151137","NCT01154166","NCT01156571","NCT01159600","NCT01159912","NCT01164501","NCT01165138","NCT01167010","NCT01167153","NCT01167881","NCT01169779","NCT01172808","NCT01172821","NCT01174693","NCT01175811","NCT01175824","NCT01176968","NCT01177384","NCT01178073","NCT01179048","NCT01181102","NCT01181167","NCT01181895","NCT01182441","NCT01186146","NCT01187966","NCT01188824","NCT01188928","NCT01189890","NCT01191268","NCT01191944","NCT01192724","NCT01194414","NCT01194882","NCT01195662","NCT01197755","NCT01202903","NCT01205932","NCT01206972","NCT01208181","NCT01208207","NCT01209702","NCT01210001","NCT01212770","NCT01214239","NCT01215097","NCT01216072","NCT01217892","NCT01218100","NCT01224171","NCT01224366","NCT01225562","NCT01227655","NCT01228747","NCT01229735","NCT01232569","NCT01233622","NCT01235130","NCT01241591","NCT01242527","NCT01243177","NCT01243424","NCT01244971","NCT01248468","NCT01252056","NCT01252953","NCT01257451","NCT01261325","NCT01262677","NCT01263925","NCT01264939","NCT01270464","NCT01277822","NCT01281787","NCT01284556","NCT01285323","NCT01286935","NCT01287039","NCT01287117","NCT01290874","NCT01291641","NCT01292473","NCT01293097","NCT01294462","NCT01294592","NCT01296412","NCT01300819","NCT01302054","NCT01302067","NCT01302691","NCT01306214","NCT01310673","NCT01313494","NCT01313637","NCT01313676","NCT01315249","NCT01316380","NCT01316887","NCT01316900","NCT01316913","NCT01318070","NCT01318083","NCT01318135","NCT01321255","NCT01323621","NCT01323634","NCT01324362","NCT01327846","NCT01329029","NCT01331837","NCT01335464","NCT01335477","NCT01336023","NCT01336608","NCT01336751","NCT01340768","NCT01342081","NCT01342913","NCT01343004","NCT01345253","NCT01345916","NCT01346865","NCT01347580","NCT01349777","NCT01350804","NCT01353235","NCT01356602","NCT01357642","NCT01358175","NCT01358578","NCT01364220","NCT01365455","NCT01366209","NCT01368081","NCT01368536","NCT01369329","NCT01369342","NCT01369355","NCT01370005","NCT01371058","NCT01371994","NCT01376245","NCT01377012","NCT01381900","NCT01388361","NCT01392326","NCT01392573","NCT01392677","NCT01394952","NCT01395745","NCT01396395","NCT01397890","NCT01408303","NCT01411735","NCT01413958","NCT01415518","NCT01422434","NCT01425359","NCT01425853","NCT01427751","NCT01429844","NCT01430260","NCT01436110","NCT01437540","NCT01437995","NCT01438814","NCT01442038","NCT01443845","NCT01444430","NCT01445951","NCT01451203","NCT01451398","NCT01455129","NCT01455857","NCT01455870","NCT01455896","NCT01456611","NCT01458951","NCT01459367","NCT01459809","NCT01460342","NCT01461369","NCT01462266","NCT01462929","NCT01465152","NCT01465763","NCT01467323","NCT01467401","NCT01470053","NCT01470937","NCT01471340","NCT01472185","NCT01472757","NCT01474369","NCT01474512","NCT01477983","NCT01479530","NCT01483560","NCT01484496","NCT01486940","NCT01488019","NCT01492361","NCT01493531","NCT01493557","NCT01494532","NCT01494987","NCT01498003","NCT01498653","NCT01498679","NCT01498822","NCT01499082","NCT01499095","NCT01499368","NCT01499953","NCT01500278","NCT01502774","NCT01507831","NCT01508936","NCT01510158","NCT01510769","NCT01512004","NCT01512108","NCT01512446","NCT01512979","NCT01513460","NCT01516879","NCT01518855","NCT01519518","NCT01519674","NCT01519791","NCT01520818","NCT01521923","NCT01522521","NCT01523301","NCT01524289","NCT01525290","NCT01525615","NCT01528254","NCT01532648","NCT01538446","NCT01541943","NCT01541956","NCT01543555","NCT01545388","NCT01548001","NCT01555138","NCT01555164","NCT01556997","NCT01558271","NCT01562561","NCT01566604","NCT01568073","NCT01573143","NCT01574651","NCT01576419","NCT01577082","NCT01578850","NCT01583218","NCT01583374","NCT01584232","NCT01590771","NCT01590797","NCT01597245","NCT01599104","NCT01602003","NCT01603082","NCT01604278","NCT01605773","NCT01606007","NCT01610037","NCT01611571","NCT01613326","NCT01615198","NCT01617434","NCT01618162","NCT01618695","NCT01619059","NCT01621178","NCT01623115","NCT01623596","NCT01624259","NCT01627327","NCT01628926","NCT01632163","NCT01633112","NCT01636713","NCT01638000","NCT01644175","NCT01644188","NCT01644500","NCT01646073","NCT01646177","NCT01646255","NCT01646320","NCT01648582","NCT01650129","NCT01652729","NCT01661634","NCT01663402","NCT01664247","NCT01668667","NCT01674647","NCT01676116","NCT01682863","NCT01687283","NCT01691521","NCT01694771","NCT01695239","NCT01696058","NCT01696110","NCT01697696","NCT01703221","NCT01706198","NCT01706211","NCT01706328","NCT01707134","NCT01708603","NCT01708629","NCT01709110","NCT01709305","NCT01709513","NCT01709864","NCT01709903","NCT01710358","NCT01710657","NCT01711359","NCT01712516","NCT01714817","NCT01715298","NCT01717300","NCT01719003","NCT01720290","NCT01720303","NCT01720446","NCT01721044","NCT01721057","NCT01722331","NCT01727141","NCT01729559","NCT01729754","NCT01730534","NCT01732770","NCT01732822","NCT01733758","NCT01734785","NCT01741194","NCT01749904","NCT01749930","NCT01752634","NCT01758198","NCT01758380","NCT01763918","NCT01764997","NCT01767519","NCT01768559","NCT01769378","NCT01772134","NCT01772147","NCT01776424","NCT01777269","NCT01777334","NCT01782326","NCT01785472","NCT01787188","NCT01787396","NCT01792518","NCT01794143","NCT01798706","NCT01808118","NCT01813422","NCT01813435","NCT01817764","NCT01822808","NCT01822899","NCT01838850","NCT01845025","NCT01849289","NCT01850615","NCT01854658","NCT01855789","NCT01860729","NCT01860976","NCT01866163","NCT01869491","NCT01870778","NCT01870804","NCT01876368","NCT01879410","NCT01880216","NCT01885208","NCT01890122","NCT01897532","NCT01899742","NCT01907854","NCT01908140","NCT01908829","NCT01911364","NCT01914757","NCT01916226","NCT01917331","NCT01917656","NCT01921972","NCT01926782","NCT01928628","NCT01928771","NCT01930188","NCT01930682","NCT01937871","NCT01946620","NCT01947491","NCT01949948","NCT01952145","NCT01954121","NCT01955161","NCT01957163","NCT01958671","NCT01959451","NCT01959529","NCT01963208","NCT01964352","NCT01966107","NCT01967550","NCT01969123","NCT01969136","NCT01969708","NCT01970475","NCT01970488","NCT01970878","NCT01973205","NCT01973231","NCT01975246","NCT01976208","NCT01985334","NCT01986855","NCT01986881","NCT01989468","NCT01989754","NCT01991795","NCT01994226","NCT01994720","NCT01999218","NCT02000336","NCT02006641","NCT02006654","NCT02006732","NCT02007720","NCT02008682","NCT02009865","NCT02014467","NCT02017171","NCT02017340","NCT02019472","NCT02022930","NCT02024646","NCT02029495","NCT02033889","NCT02036515","NCT02045862","NCT02049814","NCT02054897","NCT02058147","NCT02058160","NCT02058368","NCT02064439","NCT02064868","NCT02065791","NCT02068443","NCT02072226","NCT02072434","NCT02074982","NCT02079727","NCT02080364","NCT02082769","NCT02085161","NCT02094937","NCT02094963","NCT02100228","NCT02104674","NCT02104804","NCT02104817","NCT02105948","NCT02105961","NCT02105974","NCT02119286","NCT02121613","NCT02128932","NCT02132767","NCT02132936","NCT02138916","NCT02145468","NCT02149199","NCT02151851","NCT02152371","NCT02152605","NCT02155660","NCT02157935","NCT02159053","NCT02164513","NCT02164864","NCT02168842","NCT02172287","NCT02172300","NCT02172378","NCT02172391","NCT02172430","NCT02172443","NCT02172469","NCT02172508","NCT02172573","NCT02172586","NCT02172807","NCT02173457","NCT02173691","NCT02173782","NCT02175355","NCT02176499","NCT02177344","NCT02177357","NCT02177396","NCT02177409","NCT02177435","NCT02177448","NCT02177461","NCT02177500","NCT02178137","NCT02181985","NCT02181998","NCT02182011","NCT02183064","NCT02183129","NCT02183168","NCT02183220","NCT02183701","NCT02194205","NCT02200640","NCT02200653","NCT02203032","NCT02203916","NCT02207231","NCT02207244","NCT02207374","NCT02207491","NCT02207621","NCT02207829","NCT02224157","NCT02227550","NCT02229227","NCT02229383","NCT02229396","NCT02235402","NCT02236611","NCT02240680","NCT02242318","NCT02242812","NCT02243176","NCT02244229","NCT02244255","NCT02245490","NCT02245672","NCT02246920","NCT02254291","NCT02257385","NCT02268214","NCT02269176","NCT02273050","NCT02276222","NCT02281318","NCT02284893","NCT02294227","NCT02294396","NCT02296138","NCT02301975","NCT02305381","NCT02305849","NCT02308163","NCT02311231","NCT02337738","NCT02343458","NCT02343926","NCT02345161","NCT02346240","NCT02347774","NCT02348723","NCT02349295","NCT02352363","NCT02357459","NCT02375724","NCT02376790","NCT02384941","NCT02388724","NCT02390375","NCT02390882","NCT02396732","NCT02413398","NCT02414854","NCT02414958","NCT02416271","NCT02419612","NCT02420262","NCT02421510","NCT02441218","NCT02446912","NCT02446990","NCT02452190","NCT02453685","NCT02454491","NCT02460978","NCT02463071","NCT02463331","NCT02465515","NCT02467452","NCT02467920","NCT02471404","NCT02473198","NCT02477865","NCT02477969","NCT02483169","NCT02489968","NCT02494284","NCT02495324","NCT02498509","NCT02501161","NCT02504268","NCT02526615","NCT02528201","NCT02531035","NCT02532855","NCT02546323","NCT02551575","NCT02551874","NCT02552212","NCT02558374","NCT02561806","NCT02579850","NCT02580591","NCT02585778","NCT02597049","NCT02607306","NCT02607865","NCT02616497","NCT02623062","NCT02629159","NCT02630706","NCT02631551","NCT02648204","NCT02656173","NCT02666664","NCT02672852","NCT02681094","NCT02684357","NCT02684370","NCT02694523","NCT02706951","NCT02709538","NCT02730377","NCT02738151","NCT02738632","NCT02738879","NCT02739984","NCT02746380","NCT02761252","NCT02762578","NCT02777580","NCT02788474","NCT02791490","NCT02796677","NCT02808767","NCT02835534","NCT02836873","NCT02849080","NCT02860624","NCT02863328","NCT02870205","NCT02890173","NCT02906917","NCT02906930","NCT02916602","NCT02937701","NCT02963922","NCT02967211","NCT02967224","NCT03006276","NCT03009019","NCT03015220","NCT03021187","NCT03031834","NCT03049085","NCT03220425"];


var seedURL = "http://ec2-52-89-34-225.us-west-2.compute.amazonaws.com/classify.aspx"

var result = ""

function pausecomp(millis) // The ultimate stop for a few millis script.
{
  var date = new Date();
  var curDate = null;

  do {
    curDate = new Date();
  } while (curDate - date < millis);
}

function printTrialData (trialData, sentences){
    //debugger

    var delim = "<$>"

    for( var d in trialData){
      //debugger
      var row = trialData[d].join("<$>")+"<$>"

      if( sentences[d].length > 0 ){
        for ( var i in sentences[d] ){
          for ( var a in sentences[d][i].trData ){
            var sent = sentences[d][i].trData[a]
            var finalRow = row+sentences[d][i].caption+"<$>"+(sent ? sent.join("<$>") : "" )

            finalRow = finalRow.split(",").join(";")
            finalRow = finalRow.split("<$>").join(",")

            console.log(finalRow)

            fs.appendFile('trialData.csv', finalRow+"\n", function (err) {
              if (err) {
                console.log("failed writing: "+finalRow)
              }
            })


          }
        }
      } else {
    //    debugger
        var finalRow = (row +"<$><$><$><$><$><$><$>").split("<$>").join(",");
        console.log(finalRow);
        fs.appendFile('trialData.csv', finalRow+"\n", function (err) {
          if (err) {
            console.log("failed writing: "+finalRow)
          }
        })

      }


    }
}


async function main() {

  for ( var triid in allTrialCodes ){
    try {

      var trialid = allTrialCodes[triid] //"NCT01923415" //"NCT02242318"

      console.log("Total: "+(parseInt(triid)+1)+"/"+allTrialCodes.length);

      var trialData = await retrieveTrialData(trialid)

      var trialDataSentences = []
      for ( var d in trialData.trialData.dataFromRows ){

        pausecomp(2000);

        var data =  await retrieveSentenceData(trialid,d,
                                                trialData.viewStateValue,
                                                trialData.viewStateGenerator,
                                                trialData.eventValidation)

        var totalData = []
        for ( var da = 0; da < data.length; da++ ){
          totalData.push(data[da])
        }

        trialDataSentences.push(totalData)
        //debugger
        console.log((parseInt(d)+1)+"/"+trialData.trialData.dataFromRows.length)

        trialData.sentences = trialDataSentences
        result = trialData
      }

      trialData.sentences = trialDataSentences
      result = trialData

      printTrialData(result.trialData.dataFromRows,result.sentences)

    } catch (e) {
      console.log(e);
    }
  }

}

main();

async function retrieveTrialData (trialid){


  return new Promise(function (resolve, reject) {

    request.post({url:seedURL, form: {
      ScriptManager1: encodeURI("UpdatePanel1|btnRun"),
      // __EVENTTARGET:encodeURI(""),
      // __EVENTARGUMENT:encodeURI(""),
      __VIEWSTATE:encodeURI("WT8Jp6nsnI1375/OQNu6fXZGCvkiy1W9WA0LLeNmo8wGrbXU1DH8X9zuaQ2UKkZMMAzc7HrEFlkInb+OoR+FxM33ZFkDT4zhE7PUHP83L/hWm4DtlmBbRUW48foafHR9SHTdOCvMd9MJBqEtn5AqDU56kY8DWeuSIjbJgBCx7fRtA1KTt5/yxROGKxCkPVjoJKQpCgLzlogyg17nGdgRYA=="),
      __VIEWSTATEGENERATOR:encodeURI("01FBFEE0"),
      __EVENTVALIDATION:encodeURI("srFIejfZtRJd/IU3MUPfwkujytT+NBI2Hn0bmqo+bjBc5EifpJB/7NbgauUc8O4Yan9sP4BtrhlnOz38cUBqdv5c8AzwLeDtiVB1LB9DlQz06ArpxCKZBScMSn3Jfh2wYSEc6AKb3YBct6tjVJh3aA=="),
      txtTID: encodeURI(trialid),
        __ASYNCPOST:"true&",
      btnRun:encodeURI("Search")}}, function(err,httpResponse,body){
          var $;
          //console.log(httpResponse.body)
          var viewStateValue = ""
          var viewStateGenerator = ""
          var eventValidation = ""

          if ( httpResponse.body ){
            $ = cheerio.load(body);

            viewStateValue = $(body).find("#__VIEWSTATE")[0].attribs.value
            viewStateGenerator = $(body).find("#__VIEWSTATEGENERATOR")[0].attribs.value
            eventValidation = $(body).find("#__EVENTVALIDATION")[0].attribs.value

          }


          resolve({viewStateValue,viewStateGenerator,eventValidation, trialData : processTrialSentencesBody(body)})

       })
    })
}


async function retrieveSentenceData (trialId,sid,viewStateValue,viewStateGenerator,eventValidation){
  return new Promise(function (resolve, reject) {
      //  debugger
         request.post({url:seedURL, form: {
           ScriptManager1: encodeURI("UpdatePanel1|GVResults"),
           __EVENTTARGET:encodeURI("GVResults"),
           __EVENTARGUMENT:encodeURI("ShowNgrams$"+sid),
           __VIEWSTATE:encodeURI(viewStateValue),
           __VIEWSTATEGENERATOR:encodeURI(viewStateGenerator),
           __EVENTVALIDATION:encodeURI(eventValidation),
           txtTID: encodeURI(trialId),
           __ASYNCPOST:"true&"
           }}, function(err,httpResponse,body){
              resolve(processAttributeExtractionBody (body))

            })
          });
}



function processTrialSentencesBody (body){
  var $ = cheerio.load(body);

//  debugger

  var columns = []
  $("th[scope=col]").each(function(i, elem) {
      var col = $(elem).text()
      if( col.indexOf("View Extracted Attributes") < 0 ){
      	columns.push(col);
      }
  });

  var allTableRows = $("#PanGrid").find("tr")
  //var numberOfSentences = allTableRows.length -2 // -2 because the first two rows are dedicated to the tile of the table and the column names.



  var dataFromRows = []
  allTableRows.each ( (i,row) => {
    var rowData = []
    if ( i > 1 ){ //skipping the first two rows.
      $(row).find("td").each( (i,element) => {
        if ( i > 0 )
        rowData.push($(element).text()+"") // "" to force string just in case.
      });

      dataFromRows.push(rowData)
    }

  })
  return {columns, dataFromRows}
}

function processAttributeExtractionBody(body) {

    var $ = cheerio.load(body);
    //  console.log(body)
    //  result = body

      var returnData = {}

      var tables = $("#LabTables").children().map( (i,v) => {
        if ( v.name == "table" ) { return v }
      });

      var tablesData = tables.map( (i,v) => {
        var caption = $(v).find("caption").text()
        var dataRows = $($(v).children()[1]).find("tr")

        var dataToReturn = {}

        var headers = dataRows.map ( (i,v) => {
                          if ( i < 1 ){ //first row of the tables with the colum names
                            return $(v).find("th[scope=col]").map( (i,v) => {return $(v).text()})
                          }
                        })

        var trData = dataRows.map ( (i,v) => {
                        if ( i > 0 ){ //first row of the tables with the colum names
                          return $(v).find("td").map( (i,v) => {return $(v).text()})
                        }
                      })

       var hds = []
       headers = headers[0]
         for ( var a = 0 ; a < headers.length; a++ ) {
         hds.push(headers[a])
       }
         //  console.log(hds)

       var tdata = []

       for ( var a = 0 ; a < trData.length; a++ ) {
         var inter = []
         for ( var b = 0 ; b < trData[a].length; b++ ) {
           inter.push(trData[a][b])
         }
         tdata.push(inter)
       }
       //console.log(hds)

       dataToReturn.headers = hds
       dataToReturn.trData = tdata
       dataToReturn.caption = caption

        // console.log(trData)
        return dataToReturn
      })

      return tablesData;
}





app.get('/data', function (req, res) {
  try {
//    debugger

    // var resu = []
    // for ( var r = 0; r < result.length; r++ ){
    //     resu.push(result[r])
    // }

    res.send(JSON.stringify(result));
  } catch (ex) {
    console.log(ex);
    res.send("");
  }
});

var portUSed = 3020;
app.listen(portUSed, function () {
  console.log('App is Running on port ' + portUSed + " " + new Date().toISOString());
});
